# 文本清理功能示例

## 🧹 清理规则说明

### 📝 **括号内容过滤**
| 原文 | 清理后 |
|------|--------|
| `你好（这是括号内容）世界！` | `你好世界！` |
| `这是测试(英文括号)内容。` | `这是测试内容。` |
| `【系统提示】正常对话内容` | `正常对话内容。` |
| `《书名》引用内容` | `引用内容。` |
| `「日式引号」内容` | `内容。` |

### ⭐ **星号内容过滤**
| 原文 | 清理后 |
|------|--------|
| `正常文本*这是动作描述*继续` | `正常文本继续。` |
| `开始**强调内容**结束` | `开始结束。` |
| `＊全角星号内容＊文本` | `文本。` |

### 🗣️ **语气助词过滤**
| 原文 | 清理后 |
|------|--------|
| `嗯...那个...就是说...很好呢～` | `很好。` |
| `额额额，这个那个的，然后就好` | `就好。` |
| `哈哈哈哈哈真有趣！！！` | `真有趣。` |

### 🔄 **复合清理示例**
| 原文 | 清理后 |
|------|--------|
| `你好（旁白）*微笑*嗯...很好呢～` | `你好很好。` |
| `【提示】*动作*额，那个，不错（备注）` | `不错。` |
| `《标题》内容*动作*（注释）呵呵，好的` | `内容好的。` |

## 🛡️ **保护机制**

### ✅ **安全清理**
- 如果清理后内容过短或为空，会使用简化清理模式
- 简化模式只去除括号和星号内容，保留基本文本
- 最终保险：如果仍然为空，返回原文本

### 🎯 **清理优先级**
1. **高优先级**：括号内容 `（）()【】《》`
2. **高优先级**：星号内容 `* ** ＊`
3. **中优先级**：语气助词 `嗯啊哦呀`
4. **低优先级**：重复标点 `！！！？？？`

## 🔧 **技术实现**

### 正则表达式模式
```python
patterns_to_remove = [
    # 括号内容
    r'（[^）]*）',      # 中文圆括号
    r'\([^)]*\)',      # 英文圆括号
    r'【[^】]*】',      # 中文方括号
    r'\[[^\]]*\]',     # 英文方括号
    
    # 星号内容
    r'\*[^*]*\*',      # 单星号包围
    r'\*\*[^*]*\*\*',  # 双星号包围
    
    # 语气助词
    r'[嗯呢啊哦呀嘛吧呗哈哟咦唉嘿嘻]',
    r'额+', r'那个+', r'这个+', r'就是说+',
]
```

### 清理流程
1. **模式匹配清理** → 应用所有正则表达式规则
2. **空格标准化** → 合并多余空格和换行
3. **标点符号清理** → 去除重复标点
4. **句子过滤** → 移除过短或纯标点句子
5. **结尾标准化** → 确保以句号结尾
6. **安全检查** → 防止过度清理

## 🎵 **TTS优化效果**

### 📈 **语音质量提升**
- ✅ 去除不必要的旁白和注释
- ✅ 消除语气助词的干扰
- ✅ 提高语音的流畅度和自然度
- ✅ 减少TTS合成的错误和停顿

### 🎭 **角色体验优化**
- 不同AI角色的回答更加专业和流畅
- 避免播放动作描述和系统提示
- 保持对话内容的核心信息
- 提供更好的听觉体验

## 📊 **清理效果统计**

| 清理类型 | 覆盖模式 | 效果 |
|----------|----------|------|
| 括号内容 | 8种括号类型 | 🟢 完全过滤 |
| 星号内容 | 3种星号模式 | 🟢 完全过滤 |
| 语气助词 | 15+常见助词 | 🟢 完全过滤 |
| 网络用语 | 重复字符 | 🟢 完全过滤 |
| 标点符号 | 重复标点 | 🟢 标准化 |
| 安全保护 | 防过度清理 | 🟢 内容保护 |

现在的文本清理功能能够智能识别并过滤各种不适合语音合成的内容，确保TTS输出更加自然和专业！
