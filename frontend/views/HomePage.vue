<template>
  <div class="home-page">

    <!-- æ¬¢è¿éƒ¨åˆ† -->
    <section class="hero-section">
      <div class="hero-content">
        <h1>ä¸å†å²åäººã€æ–‡å­¦è§’è‰²å®æ—¶å¯¹è¯</h1>
        <p>é€šè¿‡AIæŠ€æœ¯ï¼Œè®©ä½ èƒ½å¤Ÿä¸ä»»ä½•ä½ æ„Ÿå…´è¶£çš„è§’è‰²è¿›è¡ŒçœŸå®çš„å¯¹è¯ä½“éªŒ</p>
        <div class="hero-actions">
          <router-link to="/characters" class="btn-primary">æµè§ˆè§’è‰²</router-link>
          <router-link to="/characters" class="btn-secondary">å¼€å§‹èŠå¤©</router-link>
        </div>
      </div>
    </section>

    <!-- ç‰¹è‰²éƒ¨åˆ† -->
    <section class="features-section">
      <h2>ä¸ºä»€ä¹ˆé€‰æ‹©æˆ‘ä»¬</h2>
      <div class="features-carousel">
        <div class="carousel-container">
          <div class="carousel-track" ref="carouselTrack">
            <!-- å…‹éš†çš„æœ€å4ä¸ªå¡ç‰‡ï¼ˆç”¨äºæ— ç¼å¾ªç¯ï¼‰ -->
            <div class="feature-item clone">
              <div class="feature-icon">ğŸ¨</div>
              <h3>ä¸ªæ€§åŒ–å®šåˆ¶</h3>
              <p>æ ¹æ®ç”¨æˆ·å–œå¥½å®šåˆ¶ä¸“å±çš„å¯¹è¯é£æ ¼å’Œè§’è‰²ç‰¹æ€§</p>
            </div>
            <div class="feature-item clone">
              <div class="feature-icon">ğŸ“±</div>
              <h3>è·¨å¹³å°åŒæ­¥</h3>
              <p>æ”¯æŒå¤šè®¾å¤‡åŒæ­¥ï¼Œéšæ—¶éšåœ°ç»§ç»­ä½ çš„å¯¹è¯</p>
            </div>
            <div class="feature-item clone">
              <div class="feature-icon">ğŸš€</div>
              <h3>æŒç»­æ›´æ–°</h3>
              <p>å®šæœŸæ›´æ–°è§’è‰²åº“å’ŒåŠŸèƒ½ï¼Œå¸¦æ¥å…¨æ–°çš„ä½“éªŒ</p>
            </div>
            <div class="feature-item clone">
              <div class="feature-icon">ğŸ’¡</div>
              <h3>æ™ºèƒ½æ¨è</h3>
              <p>åŸºäºç”¨æˆ·å…´è¶£æ™ºèƒ½æ¨èåˆé€‚çš„è§’è‰²å’Œè¯é¢˜</p>
            </div>
            
            <!-- åŸå§‹å¡ç‰‡ -->
            <div class="feature-item">
              <div class="feature-icon">ğŸ‘¥</div>
              <h3>ä¸°å¯Œçš„è§’è‰²åº“</h3>
              <p>åŒ…å«å†å²äººç‰©ã€æ–‡å­¦è§’è‰²ã€ç§‘å­¦å®¶ç­‰å¤šç§ç±»å‹çš„è§’è‰²ä¾›ä½ é€‰æ‹©</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ’¬</div>
              <h3>è‡ªç„¶å¯¹è¯ä½“éªŒ</h3>
              <p>åŸºäºå…ˆè¿›çš„ä¸ƒç‰›äº‘AIå¤§æ¨¡å‹ï¼Œæä¾›æµç•…è‡ªç„¶çš„å¯¹è¯ä½“éªŒ</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ™ï¸</div>
              <h3>è¯­éŸ³äº¤äº’</h3>
              <p>æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¯­éŸ³è¾“å‡ºï¼Œè®©å¯¹è¯æ›´åŠ ä¾¿æ·è‡ªç„¶</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">âš¡</div>
              <h3>å®æ—¶å“åº”</h3>
              <p>æµå¼ä¼ è¾“æŠ€æœ¯ï¼Œè®©ä½ æ„Ÿå—åˆ°å®æ—¶çš„å¯¹è¯åé¦ˆ</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ’–</div>
              <h3>äº²å¯†åº¦ç³»ç»Ÿ</h3>
              <p>ä¸è§’è‰²å»ºç«‹æ·±åº¦è¿æ¥ï¼Œè§£é”ä¸åŒå±‚æ¬¡çš„äº¤æµä½“éªŒ</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ“Š</div>
              <h3>ä¸ªäººä¸­å¿ƒ</h3>
              <p>æŸ¥çœ‹äº²å¯†åº¦æ’è¡Œã€ç®¡ç†å¯¹è¯å†å²ï¼Œè¿½è¸ªä½ çš„æˆé•¿è½¨è¿¹</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ”’</div>
              <h3>éšç§ä¿æŠ¤</h3>
              <p>ä¸¥æ ¼ä¿æŠ¤ç”¨æˆ·éšç§ï¼Œå¯¹è¯æ•°æ®å®‰å…¨åŠ å¯†å­˜å‚¨</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸŒ</div>
              <h3>å¤šè¯­è¨€æ”¯æŒ</h3>
              <p>æ”¯æŒå¤šç§è¯­è¨€äº¤æµï¼Œæ‰“ç ´è¯­è¨€éšœç¢</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ¨</div>
              <h3>ä¸ªæ€§åŒ–å®šåˆ¶</h3>
              <p>æ ¹æ®ç”¨æˆ·å–œå¥½å®šåˆ¶ä¸“å±çš„å¯¹è¯é£æ ¼å’Œè§’è‰²ç‰¹æ€§</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ“±</div>
              <h3>è·¨å¹³å°åŒæ­¥</h3>
              <p>æ”¯æŒå¤šè®¾å¤‡åŒæ­¥ï¼Œéšæ—¶éšåœ°ç»§ç»­ä½ çš„å¯¹è¯</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸš€</div>
              <h3>æŒç»­æ›´æ–°</h3>
              <p>å®šæœŸæ›´æ–°è§’è‰²åº“å’ŒåŠŸèƒ½ï¼Œå¸¦æ¥å…¨æ–°çš„ä½“éªŒ</p>
            </div>
            <div class="feature-item">
              <div class="feature-icon">ğŸ’¡</div>
              <h3>æ™ºèƒ½æ¨è</h3>
              <p>åŸºäºç”¨æˆ·å…´è¶£æ™ºèƒ½æ¨èåˆé€‚çš„è§’è‰²å’Œè¯é¢˜</p>
            </div>
            
            <!-- å…‹éš†çš„å‰4ä¸ªå¡ç‰‡ï¼ˆç”¨äºæ— ç¼å¾ªç¯ï¼‰ -->
            <div class="feature-item clone">
              <div class="feature-icon">ğŸ‘¥</div>
              <h3>ä¸°å¯Œçš„è§’è‰²åº“</h3>
              <p>åŒ…å«å†å²äººç‰©ã€æ–‡å­¦è§’è‰²ã€ç§‘å­¦å®¶ç­‰å¤šç§ç±»å‹çš„è§’è‰²ä¾›ä½ é€‰æ‹©</p>
            </div>
            <div class="feature-item clone">
              <div class="feature-icon">ğŸ’¬</div>
              <h3>è‡ªç„¶å¯¹è¯ä½“éªŒ</h3>
              <p>åŸºäºå…ˆè¿›çš„ä¸ƒç‰›äº‘AIå¤§æ¨¡å‹ï¼Œæä¾›æµç•…è‡ªç„¶çš„å¯¹è¯ä½“éªŒ</p>
            </div>
            <div class="feature-item clone">
              <div class="feature-icon">ğŸ™ï¸</div>
              <h3>è¯­éŸ³äº¤äº’</h3>
              <p>æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¯­éŸ³è¾“å‡ºï¼Œè®©å¯¹è¯æ›´åŠ ä¾¿æ·è‡ªç„¶</p>
            </div>
            <div class="feature-item clone">
              <div class="feature-icon">âš¡</div>
              <h3>å®æ—¶å“åº”</h3>
              <p>æµå¼ä¼ è¾“æŠ€æœ¯ï¼Œè®©ä½ æ„Ÿå—åˆ°å®æ—¶çš„å¯¹è¯åé¦ˆ</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- çƒ­é—¨è§’è‰² -->
    <section class="popular-characters">
      <h2>çƒ­é—¨è§’è‰²</h2>
      <div class="characters-container">
        <CharacterCard
          v-for="character in popularCharacters"
          :key="character.id"
          :character="character"
          @select="selectCharacter"
        />
      </div>
      <div class="view-more">
        <router-link to="/characters">æŸ¥çœ‹æ›´å¤šè§’è‰² â†’</router-link>
      </div>
    </section>

    <!-- ä½¿ç”¨è¯´æ˜ -->
    <section class="how-it-works">
      <h2>å¦‚ä½•ä½¿ç”¨</h2>
      <div class="steps-flow">
        <!-- ä½¿ç”¨ç½‘æ ¼å¸ƒå±€ -->
        <div class="steps-grid">
          <!-- ç¬¬ä¸€è¡Œ -->
          <div class="step-item" style="grid-area: step1;">
            <div class="step-number">1</div>
            <h3>æ³¨å†Œç™»å½•</h3>
            <p>åˆ›å»ºè´¦æˆ·æˆ–ç™»å½•ï¼Œäº«å—å®Œæ•´åŠŸèƒ½ä½“éªŒ</p>
          </div>
          
          <div class="arrow-horizontal" style="grid-area: arrow1;">
            <svg viewBox="0 0 120 40" class="arrow-svg">
              <defs>
                <marker id="arrowhead1" markerWidth="10" markerHeight="7" 
                        refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="#4c84ff" />
                </marker>
              </defs>
              <line x1="10" y1="20" x2="110" y2="20" 
                    stroke="#4c84ff" stroke-width="2" 
                    stroke-dasharray="5,5" marker-end="url(#arrowhead1)" />
            </svg>
          </div>
          
          <div class="step-item" style="grid-area: step2;">
            <div class="step-number">2</div>
            <h3>é€‰æ‹©è§’è‰²</h3>
            <p>ä»ä¸°å¯Œçš„è§’è‰²åº“ä¸­é€‰æ‹©ä½ æ„Ÿå…´è¶£çš„å†å²äººç‰©æˆ–æ–‡å­¦è§’è‰²</p>
          </div>
          
          <div class="arrow-horizontal" style="grid-area: arrow2;">
            <svg viewBox="0 0 120 40" class="arrow-svg">
              <defs>
                <marker id="arrowhead2" markerWidth="10" markerHeight="7" 
                        refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="#4c84ff" />
                </marker>
              </defs>
              <line x1="10" y1="20" x2="110" y2="20" 
                    stroke="#4c84ff" stroke-width="2" 
                    stroke-dasharray="5,5" marker-end="url(#arrowhead2)" />
            </svg>
          </div>
          
          <div class="step-item" style="grid-area: step3;">
            <div class="step-number">3</div>
            <h3>å¼€å§‹å¯¹è¯</h3>
            <p>é€šè¿‡æ–‡å­—æˆ–è¯­éŸ³ä¸è§’è‰²è¿›è¡Œæ·±åº¦äº¤æµï¼Œæ¢ç´¢ä»–ä»¬çš„æ€æƒ³ä¸–ç•Œ</p>
          </div>
          
          
          <!-- ç¬¬äºŒè¡Œ -->
          <div class="step-item" style="grid-area: step4;">
            <div class="step-number">4</div>
            <h3>å»ºç«‹äº²å¯†åº¦</h3>
            <p>æ¯æ¬¡æˆåŠŸå¯¹è¯éƒ½ä¼šå¢åŠ äº²å¯†åº¦ï¼Œè§£é”æ›´æ·±å±‚çš„äº¤æµä½“éªŒ</p>
          </div>
          
          <div class="arrow-horizontal" style="grid-area: arrow4;">
            <svg viewBox="0 0 120 40" class="arrow-svg">
              <defs>
                <marker id="arrowhead4" markerWidth="10" markerHeight="7" 
                        refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="#4c84ff" />
                </marker>
              </defs>
              <line x1="10" y1="20" x2="110" y2="20" 
                    stroke="#4c84ff" stroke-width="2" 
                    stroke-dasharray="5,5" marker-end="url(#arrowhead4)" />
            </svg>
          </div>
          
          <div class="step-item" style="grid-area: step5;">
            <div class="step-number">5</div>
            <h3>æŸ¥çœ‹æ’è¡Œ</h3>
            <p>åœ¨ä¸ªäººä¸­å¿ƒæŸ¥çœ‹äº²å¯†åº¦æ’è¡Œï¼Œè¿½è¸ªä¸å„è§’è‰²çš„å…³ç³»è¿›å±•</p>
          </div>
          
          <div class="arrow-horizontal" style="grid-area: arrow5;">
            <svg viewBox="0 0 120 40" class="arrow-svg">
              <defs>
                <marker id="arrowhead5" markerWidth="10" markerHeight="7" 
                        refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="#4c84ff" />
                </marker>
              </defs>
              <line x1="10" y1="20" x2="110" y2="20" 
                    stroke="#4c84ff" stroke-width="2" 
                    stroke-dasharray="5,5" marker-end="url(#arrowhead5)" />
            </svg>
          </div>
          
          <div class="step-item" style="grid-area: step6;">
            <div class="step-number">6</div>
            <h3>ç®¡ç†å†å²</h3>
            <p>éšæ—¶æŸ¥çœ‹å¯¹è¯å†å²ï¼Œç»§ç»­ä¹‹å‰çš„ç²¾å½©å¯¹è¯</p>
          </div>
          
        </div>
      </div>
    </section>

    <!-- äº²å¯†åº¦ç³»ç»Ÿä»‹ç» -->
    <section class="intimacy-system">
      <h2>ğŸ’– äº²å¯†åº¦ç³»ç»Ÿ</h2>
      <div class="intimacy-content">
        <div class="intimacy-description">
          <div class="title-with-tooltip">
            <h3>ä¸è§’è‰²å»ºç«‹æ·±åº¦è¿æ¥</h3>
            <div class="tooltip-container">
              <span class="question-mark">?</span>
              <div class="tooltip-content">
                <h4>æ·±åº¦è¿æ¥çš„å«ä¹‰</h4>
                <p>å½“è¾¾æˆä¸åŒäº²å¯†åº¦æ—¶ï¼Œæ‚¨å¯ä»¥è§£é”ä»¥ä¸‹ç‰¹æ®Šä½“éªŒï¼š</p>
                <ul>
                  <li>ğŸŒŸ <strong>ä¸ªæ€§åŒ–é—®å€™</strong>ï¼šè§’è‰²ä¼šäº²åˆ‡åœ°é—®å€™æ‚¨ï¼Œè¯¢é—®æ‚¨æœ€è¿‘å¦‚ä½•ã€å¿ƒæƒ…æ€ä¹ˆæ ·</li>
                  <li>ğŸ’¬ <strong>è®°å¿†å»¶ç»­</strong>ï¼šè§’è‰²ä¼šè®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼Œè®©äº¤æµæ›´åŠ è¿è´¯</li>
                  <li>ğŸ­ <strong>æƒ…æ„Ÿå…±é¸£</strong>ï¼šæ ¹æ®äº²å¯†åº¦ç­‰çº§ï¼Œè§’è‰²ä¼šå±•ç°ä¸åŒçš„æƒ…æ„Ÿè¡¨è¾¾æ–¹å¼</li>
                  <li>ğŸ”“ <strong>æ·±å±‚è¯é¢˜</strong>ï¼šè§£é”æ›´ç§å¯†ã€æ›´æ·±å…¥çš„å¯¹è¯ä¸»é¢˜å’Œå†…å®¹</li>
                </ul>
              </div>
            </div>
          </div>
          <p>æ¯æ¬¡æˆåŠŸçš„å¯¹è¯éƒ½ä¼šå¢åŠ ä½ ä¸è§’è‰²çš„äº²å¯†åº¦ï¼Œéšç€å…³ç³»çš„æ·±å…¥ï¼Œä½ å°†ä½“éªŒåˆ°ä¸åŒå±‚æ¬¡çš„äº¤æµï¼š</p>
        </div>
        <div class="intimacy-levels">
          <div class="level-item">
            <div class="level-badge-container">
              <div class="level-badge level-1">1</div>
              <div class="emoji-hover">ğŸ‘‹</div>
            </div>
            <span class="level-name">åˆæ¬¡ç›¸è¯†</span>
          </div>
          <div class="level-arrow">â†’</div>
          <div class="level-item">
            <div class="level-badge-container">
              <div class="level-badge level-5">5</div>
              <div class="emoji-hover">ğŸ”¥</div>
            </div>
            <span class="level-name">èŠå¾—ç«çƒ­</span>
          </div>
          <div class="level-arrow">â†’</div>
          <div class="level-item">
            <div class="level-badge-container">
              <div class="level-badge level-10">10</div>
              <div class="emoji-hover">ğŸ’«</div>
            </div>
            <span class="level-name">ç›¸è§æ¨æ™š</span>
          </div>
          <div class="level-arrow">â†’</div>
          <div class="level-item">
            <div class="level-badge-container">
              <div class="level-badge level-20">20</div>
              <div class="emoji-hover">ğŸ’•</div>
            </div>
            <span class="level-name">äº²å¯†æ— é—´</span>
          </div>
          <div class="level-arrow">â†’</div>
          <div class="level-item">
            <div class="level-badge-container">
              <div class="level-badge level-50">50</div>
              <div class="emoji-hover">ğŸµ</div>
            </div>
            <span class="level-name">çŸ¥éŸ³éš¾è§…</span>
          </div>
          <div class="level-arrow">â†’</div>
          <div class="level-item">
            <div class="level-badge-container">
              <div class="level-badge level-100">100</div>
              <div class="emoji-hover">ğŸ‘‘</div>
            </div>
            <span class="level-name">ä¼¯ä¹</span>
          </div>
        </div>
      </div>
    </section>
  </div>
</template>

<script>
import { ref, onMounted, onUnmounted } from 'vue'
import CharacterCard from '../components/CharacterCard.vue'
import apiService from '../apiService'
import { useRouter } from 'vue-router'

export default {
  name: 'HomePage',
  components: {
    CharacterCard
  },
  setup() {
    const router = useRouter()
    const popularCharacters = ref([])
    const carouselTrack = ref(null)
    const currentSlide = ref(0)
    const totalSlides = 3
    let carouselInterval = null

    // åŠ è½½çƒ­é—¨è§’è‰²
    const loadPopularCharacters = async () => {
      try {
        const configs = await apiService.getCharacterConfigs()
        // æŒ‰è§’è‰²åç§°é¦–å­—æ¯æ’åºï¼Œç„¶åå–å‰6ä¸ª
        const sortedConfigs = configs.sort((a, b) => {
          return a.name.localeCompare(b.name, 'zh-CN', { sensitivity: 'base' })
        })
        popularCharacters.value = sortedConfigs.slice(0, 6)
      } catch (error) {
        console.error('åŠ è½½è§’è‰²æ•°æ®å¤±è´¥:', error)
        popularCharacters.value = []
      }
    }

    // é€‰æ‹©è§’è‰²
    const selectCharacter = (character) => {
      router.push({
        name: 'Chat',
        params: { characterId: character.id }
      })
    }

    // æ›´æ–°å¡ç‰‡é€æ˜åº¦çš„å‡½æ•°
    const updateCardOpacity = () => {
      if (!carouselTrack.value) return
      
      const cards = carouselTrack.value.querySelectorAll('.feature-item')
      const viewportWidth = window.innerWidth
      const viewportCenter = viewportWidth / 2
      
      // å®šä¹‰æ¸å˜å‚æ•°ï¼ŒåŸºäºè§†å£å®½åº¦
      const fullVisibleDistance = Math.min(600, viewportWidth * 0.35) // å®Œå…¨å¯è§çš„è·ç¦»èŒƒå›´ï¼Œæœ€å¤§600px
      const fadeDistance = Math.min(400, viewportWidth * 0.25) // æ¸å˜è·ç¦»ï¼Œæœ€å¤§400px
      
      cards.forEach(card => {
        const cardRect = card.getBoundingClientRect()
        const cardCenter = cardRect.left + cardRect.width / 2
        const distanceFromCenter = Math.abs(cardCenter - viewportCenter)
        
        let opacity = 1
        
        // å¦‚æœè·ç¦»è§†å£ä¸­å¿ƒè¶…è¿‡å®Œå…¨å¯è§èŒƒå›´ï¼Œå¼€å§‹æ¸éš
        if (distanceFromCenter > fullVisibleDistance) {
          const fadeProgress = (distanceFromCenter - fullVisibleDistance) / fadeDistance
          // ä½¿ç”¨æ›´å¹³æ»‘çš„ç¼“åŠ¨å‡½æ•°
          const clampedProgress = Math.min(1, Math.max(0, fadeProgress))
          const smoothProgress = 1 - Math.pow(1 - clampedProgress, 2) // äºŒæ¬¡ç¼“åŠ¨ï¼Œæ›´æŸ”å’Œ
          opacity = Math.max(0, 1 - smoothProgress)
        }
        
        card.style.opacity = opacity
        card.style.transition = 'opacity 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.3s ease, box-shadow 0.3s ease'
      })
    }

    // è½®æ’­åŠŸèƒ½ - JavaScriptæ§åˆ¶çš„æ— ç¼å¾ªç¯
    const initCarousel = () => {
      try {
        console.log('è½®æ’­ç»„ä»¶å·²åˆå§‹åŒ–ï¼Œä½¿ç”¨JavaScriptæ§åˆ¶')
        if (carouselTrack.value) {
          console.log('è½®æ’­è½¨é“å…ƒç´ å·²æ‰¾åˆ°ï¼Œå¼€å§‹JavaScriptåŠ¨ç”»')
          
          // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
          const isMobile = window.innerWidth <= 768
          const cardWidth = isMobile ? 276 : 304 // ç§»åŠ¨ç«¯276pxï¼Œæ¡Œé¢ç«¯304px
          
          let currentOffset = -4 * cardWidth // åˆå§‹åç§»é‡ï¼ˆè·³è¿‡å‰4ä¸ªå…‹éš†å¡ç‰‡ï¼‰
          let isHovered = false
          
          // ç›‘å¬é¼ æ ‡æ‚¬åœäº‹ä»¶
          const carouselContainer = carouselTrack.value.parentElement.parentElement
          carouselContainer.addEventListener('mouseenter', () => {
            isHovered = true
          })
          carouselContainer.addEventListener('mouseleave', () => {
            isHovered = false
          })
          
          // å¹³æ»‘æ»šåŠ¨å‡½æ•°
          const smoothScroll = () => {
            if (!isHovered && carouselTrack.value) {
              currentOffset -= 2 // æ¯æ¬¡ç§»åŠ¨2pxï¼Œå¢åŠ æ»šåŠ¨é€Ÿåº¦
              
              // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®ä½ç½®ï¼ˆæ— ç¼å¾ªç¯ï¼‰
              if (currentOffset <= -16 * cardWidth) { // å½“ç§»åŠ¨åˆ°æœ€å4ä¸ªå…‹éš†å¡ç‰‡æ—¶
                // ç¬é—´é‡ç½®åˆ°åˆå§‹ä½ç½®ï¼Œåˆ›å»ºæ— ç¼å¾ªç¯æ•ˆæœ
                carouselTrack.value.style.transition = 'none'
                currentOffset = -4 * cardWidth
                carouselTrack.value.style.transform = `translateX(${currentOffset}px)`
                
                // å¼ºåˆ¶é‡ç»˜
                carouselTrack.value.offsetHeight
                
                // æ¢å¤è¿‡æ¸¡åŠ¨ç”»
                setTimeout(() => {
                  if (carouselTrack.value) {
                    carouselTrack.value.style.transition = 'transform 0.1s linear'
                  }
                }, 10)
              } else {
                carouselTrack.value.style.transform = `translateX(${currentOffset}px)`
              }
            }
          }
          
          // å¯åŠ¨æ»šåŠ¨åŠ¨ç”»
          const scrollInterval = setInterval(smoothScroll, 50) // æ¯50msç§»åŠ¨ä¸€æ¬¡
          
          // å¯åŠ¨é€æ˜åº¦æ›´æ–°
          const updateInterval = setInterval(updateCardOpacity, 100)
          
          // å­˜å‚¨å®šæ—¶å™¨IDä»¥ä¾¿æ¸…ç†
          carouselTrack.value._scrollInterval = scrollInterval
          carouselTrack.value._opacityInterval = updateInterval
        } else {
          console.error('è½®æ’­è½¨é“å…ƒç´ æœªæ‰¾åˆ°')
        }
      } catch (error) {
        console.error('è½®æ’­åˆå§‹åŒ–é”™è¯¯:', error)
      }
    }

    onMounted(() => {
      loadPopularCharacters()
      // åˆå§‹åŒ–è½®æ’­
      setTimeout(() => {
        initCarousel()
      }, 200)
    })

    onUnmounted(() => {
      // æ¸…ç†æ‰€æœ‰å®šæ—¶å™¨
      if (carouselTrack.value) {
        if (carouselTrack.value._scrollInterval) {
          clearInterval(carouselTrack.value._scrollInterval)
        }
        if (carouselTrack.value._opacityInterval) {
          clearInterval(carouselTrack.value._opacityInterval)
        }
      }
    })

    return {
      // æ•°æ®
      popularCharacters,
      carouselTrack,
      
      // æ–¹æ³•
      selectCharacter
    }
  }
}
</script>

<style scoped>
/* é¦–é¡µæ ·å¼ */
.home-page {
  max-width: 1200px;
  margin: 0 auto;
  overflow-x: hidden; /* ç¦æ­¢æ°´å¹³æ»šåŠ¨ */
}

/* è‹±é›„åŒºåŸŸ */
.hero-section {
  background: linear-gradient(135deg, #4c84ff 0%, #7a5cf0 100%);
  color: white;
  border-radius: 16px;
  padding: 80px 40px;
  margin-bottom: 40px;
  text-align: center;
}

.hero-content h1 {
  font-size: 36px;
  margin-bottom: 16px;
  font-weight: 700;
}

.hero-content p {
  font-size: 18px;
  margin-bottom: 32px;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}

.hero-actions {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
}

.btn-primary,
.btn-secondary {
  padding: 12px 24px;
  border-radius: 24px;
  font-size: 16px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
  cursor: pointer;
  border: none;
}

.btn-primary {
  background-color: white;
  color: #4c84ff;
}

.btn-primary:hover {
  background-color: #f0f0f0;
  transform: translateY(-2px);
}

.btn-secondary {
  background-color: rgba(255, 255, 255, 0.2);
  color: white;
  backdrop-filter: blur(10px);
}

.btn-secondary:hover {
  background-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

/* ç‰¹è‰²åŒºåŸŸ */
.features-section {
  margin-bottom: 60px;
  text-align: center;
}

.features-section h2 {
  font-size: 28px;
  margin-bottom: 32px;
  color: #333;
}

/* è½®æ’­å®¹å™¨ */
.features-carousel {
  position: relative;
  width: 100%; /* ç§»é™¤å®½åº¦é™åˆ¶ï¼Œè®©è½®æ’­å æ»¡æ•´ä¸ªå±å¹•å®½åº¦ */
  margin: 0;
  padding: 60px 0; /* è¿›ä¸€æ­¥å¢åŠ ä¸Šä¸‹å†…è¾¹è·ï¼Œç¡®ä¿é˜´å½±å’Œç‰¹æ•ˆä¸è¢«é®æŒ¡ */
}

.carousel-container {
  overflow: visible; /* å…è®¸é˜´å½±å’Œç‰¹æ•ˆå®Œå…¨æ˜¾ç¤º */
  padding: 0; /* ç§»é™¤å†…è¾¹è·é™åˆ¶ */
  margin: 0; /* ç§»é™¤è´Ÿè¾¹è· */
  position: relative;
  width: 100%; /* å æ»¡æ•´ä¸ªå®½åº¦ */
}

/* ç§»é™¤é®ç½©å±‚ï¼Œç›´æ¥é€šè¿‡å¡ç‰‡é€æ˜åº¦æ§åˆ¶æ¸éšæ¸æ˜¾ */

.carousel-track {
  display: flex;
  /* æ€»å…±20ä¸ªå¡ç‰‡ï¼š4ä¸ªå…‹éš† + 12ä¸ªåŸå§‹ + 4ä¸ªå…‹éš† */
  width: calc(20 * 304px); /* æ¯ä¸ªå¡ç‰‡304pxå®½åº¦ï¼ˆåŒ…å«é—´è·ï¼‰ */
  /* ä½¿ç”¨JavaScriptæ§åˆ¶çš„å¹³æ»‘åŠ¨ç”» */
  transition: transform 0.1s linear;
  /* åˆå§‹ä½ç½®åç§»ï¼Œè·³è¿‡å‰4ä¸ªå…‹éš†å¡ç‰‡ */
  transform: translateX(calc(-4 * 304px));
}

.carousel-track .feature-item {
  flex: 0 0 280px; /* å›ºå®šå®½åº¦ï¼Œä¿æŒç°æœ‰å¡ç‰‡å¤§å° */
  margin: 0 12px; /* å·¦å³é—´è· */
}

/* æ‚¬åœæ—¶æš‚åœåŠ¨ç”» */
.features-carousel:hover .carousel-track {
  transition: transform 0.3s ease;
}

.feature-item {
  background-color: white;
  padding: 32px;
  border-radius: 16px; /* å¢åŠ å¡ç‰‡åœ†è§’ï¼Œä¸å®¹å™¨åè°ƒ */
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease, opacity 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.8); /* è½»å¾®çš„è¾¹æ¡†å¢å¼ºå±‚æ¬¡ */
  position: relative; /* ç¡®ä¿z-indexç”Ÿæ•ˆ */
  opacity: 1; /* é»˜è®¤å®Œå…¨å¯è§ */
}

.feature-item:hover {
  transform: translateY(-12px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
  z-index: 20; /* æé«˜z-indexï¼Œç¡®ä¿æ‚¬åœçš„å¡ç‰‡åœ¨é®ç½©ä¹‹ä¸Š */
  position: relative; /* ç¡®ä¿z-indexç”Ÿæ•ˆ */
}

/* ç¡®ä¿æ‚¬åœæ•ˆæœä¸è¢«è£å‰ª */
.carousel-track .feature-item {
  position: relative;
  /* å¢åŠ é¢å¤–çš„è¾¹è·ç¡®ä¿é˜´å½±ç©ºé—´ */
  margin-top: 20px;
  margin-bottom: 20px;
}

.feature-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.feature-item h3 {
  font-size: 20px;
  margin-bottom: 12px;
  color: #333;
}

.feature-item p {
  color: #666;
  font-size: 14px;
  line-height: 1.6;
}


/* çƒ­é—¨è§’è‰²åŒºåŸŸ */
.popular-characters {
  margin-bottom: 60px;
}

.popular-characters h2 {
  font-size: 28px;
  margin-bottom: 24px;
  color: #333;
  text-align: center;
}

.characters-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 24px;
}

.view-more {
  text-align: center;
}

.view-more a {
  color: #4c84ff;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.3s ease;
}

.view-more a:hover {
  color: #3a6ed8;
  text-decoration: underline;
}

/* ä½¿ç”¨è¯´æ˜åŒºåŸŸ */
.how-it-works {
  background-color: white;
  padding: 60px 40px;
  border-radius: 16px;
  text-align: center;
}

.how-it-works h2 {
  font-size: 28px;
  margin-bottom: 32px;
  color: #333;
}

/* æ­¥éª¤æµç¨‹å®¹å™¨ */
.steps-flow {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.steps-grid {
  display: grid;
  grid-template-columns: 1fr 120px 1fr 120px 1fr;
  grid-template-rows: auto 40px auto;
  grid-template-areas: 
    "step1 arrow1 step2 arrow2 step3"
    ". . . . ."
    "step4 arrow4 step5 arrow5 step6";
  gap: 20px;
  justify-items: center;
  align-items: center;
}


.step-item {
  position: relative;
  padding: 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  min-width: 220px;
  max-width: 240px;
  text-align: center;
}

.step-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.step-number {
  width: 60px;
  height: 60px;
  background-color: #4c84ff;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: bold;
  margin: 0 auto 20px;
}

.step-item h3 {
  font-size: 20px;
  margin-bottom: 12px;
  color: #333;
}

.step-item p {
  color: #666;
  font-size: 14px;
  line-height: 1.6;
}

/* æ°´å¹³ç®­å¤´ */
.arrow-horizontal {
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 120px;
  height: 40px;
}

.arrow-horizontal .arrow-svg {
  width: 120px;
  height: 40px;
}

/* å‚ç›´ç®­å¤´ */
.arrow-vertical {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 40px;
  height: 120px;
}

.arrow-vertical .arrow-svg {
  width: 40px;
  height: 120px;
}

/* è¿”å›ç®­å¤´ */
.arrow-back {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 300px;
  height: 40px;
}

.arrow-back .arrow-svg {
  width: 300px;
  height: 40px;
}

/* äº²å¯†åº¦ç³»ç»Ÿä»‹ç» */
.intimacy-system {
  background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
  color: white;
  padding: 60px 40px;
  border-radius: 16px;
  margin-top: 40px;
  text-align: center;
}

.intimacy-system h2 {
  font-size: 28px;
  margin-bottom: 32px;
}

.intimacy-content {
  max-width: 1000px;
  margin: 0 auto;
}

.intimacy-description h3 {
  font-size: 22px;
  margin-bottom: 16px;
}

/* æ ‡é¢˜ä¸æç¤ºæ¡†å®¹å™¨ */
.title-with-tooltip {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 16px;
  text-align: center;
}

.title-with-tooltip h3 {
  margin-bottom: 0;
}

/* é—®å·æ ‡è¯† */
.tooltip-container {
  position: relative;
  display: inline-block;
}

.question-mark {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 20px;
  height: 20px;
  background: rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  font-size: 12px;
  font-weight: bold;
  color: white;
  cursor: help;
  transition: all 0.3s ease;
}

.question-mark:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

/* æç¤ºæ¡†å†…å®¹ */
.tooltip-content {
  position: absolute;
  top: 50%;
  left: 100%;
  margin-left: 12px;
  transform: translateY(-50%) translateX(-10px);
  width: 480px;
  background: white;
  color: #333;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  z-index: 1000;
}

.tooltip-container:hover .tooltip-content {
  opacity: 1;
  visibility: visible;
  transform: translateY(-50%) translateX(0);
}

.tooltip-content h4 {
  margin: 0 0 12px 0;
  font-size: 16px;
  font-weight: 600;
  color: #1f2937;
}

.tooltip-content p {
  margin: 0 0 12px 0;
  font-size: 14px;
  color: #4b5563;
  line-height: 1.5;
}

.tooltip-content ul {
  margin: 0;
  padding: 0;
  list-style: none;
}

.tooltip-content li {
  margin-bottom: 8px;
  font-size: 13px;
  line-height: 1.4;
  color: #374151;
  display: flex;
  align-items: flex-start;
  gap: 6px;
  white-space: nowrap;
}

.tooltip-content li:last-child {
  margin-bottom: 0;
}

.tooltip-content strong {
  color: #1f2937;
}

/* æç¤ºæ¡†ç®­å¤´ */
.tooltip-content::before {
  content: '';
  position: absolute;
  top: 50%;
  left: -6px;
  transform: translateY(-50%) rotate(45deg);
  width: 12px;
  height: 12px;
  background: white;
  box-shadow: -2px -2px 4px rgba(0, 0, 0, 0.1);
}

.intimacy-description p {
  font-size: 16px;
  margin-bottom: 40px;
  opacity: 0.9;
}

.intimacy-levels {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 16px;
}

.level-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  min-width: 80px;
}

.level-badge-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.level-badge {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 16px;
  color: white;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.level-badge.level-1 {
  background: linear-gradient(135deg, #94a3b8, #cbd5e1);
}

.level-badge.level-5 {
  background: linear-gradient(135deg, #10b981, #34d399);
}

.level-badge.level-10 {
  background: linear-gradient(135deg, #3b82f6, #60a5fa);
}

.level-badge.level-20 {
  background: linear-gradient(135deg, #8b5cf6, #a78bfa);
}

.level-badge.level-50 {
  background: linear-gradient(135deg, #f59e0b, #fbbf24);
}

.level-badge.level-100 {
  background: linear-gradient(135deg, #ef4444, #f87171);
}

/* Emojiæ‚¬åœæ•ˆæœ */
.emoji-hover {
  position: absolute;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
  opacity: 0;
  transition: all 0.3s ease;
  pointer-events: none;
  z-index: 10;
}

.level-badge-container:hover .emoji-hover {
  opacity: 1;
  transform: translateX(-50%) translateY(-5px);
}

.level-badge-container:hover .level-badge {
  transform: scale(1.1);
  transition: transform 0.3s ease;
}

.level-badge {
  transition: transform 0.3s ease;
}

.level-name {
  font-size: 12px;
  font-weight: 600;
  text-align: center;
  opacity: 0.9;
}

.level-arrow {
  color: rgba(255, 255, 255, 0.7);
  font-size: 20px;
  font-weight: bold;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .hero-section {
    padding: 60px 20px;
  }
  
  .hero-content h1 {
    font-size: 28px;
  }
  
  .hero-content p {
    font-size: 16px;
  }
  
  .features-section h2,
  .popular-characters h2,
  .how-it-works h2,
  .intimacy-system h2 {
    font-size: 24px;
  }
  
  /* ç§»åŠ¨ç«¯è½®æ’­é€‚é… */
  .features-carousel {
    width: 100vw; /* ç§»åŠ¨ç«¯å æ»¡æ•´ä¸ªè§†å£å®½åº¦ */
    padding: 50px 0; /* ç§»åŠ¨ç«¯ä¹Ÿå¢åŠ ä¸Šä¸‹ç©ºé—´ */
    margin: 0; /* ç§»é™¤è¾¹è·é™åˆ¶ */
  }
  
  .carousel-container {
    overflow: visible; /* ç§»åŠ¨ç«¯ä¹Ÿå…è®¸é˜´å½±å®Œå…¨æ˜¾ç¤º */
    padding: 0; /* ç§»é™¤å†…è¾¹è·é™åˆ¶ */
    margin: 0; /* ç§»é™¤è´Ÿè¾¹è· */
    position: relative;
    width: 100%; /* å æ»¡æ•´ä¸ªå®½åº¦ */
  }

  /* ç§»åŠ¨ç«¯ä¹Ÿç§»é™¤é®ç½©ï¼Œç›´æ¥ä½¿ç”¨å¡ç‰‡é€æ˜åº¦æ§åˆ¶ */
  
  .carousel-track {
    /* ç§»åŠ¨ç«¯ä½¿ç”¨æ›´å°çš„å¡ç‰‡å®½åº¦é‡æ–°è®¡ç®— */
    width: calc(20 * 276px); /* 260pxå¡ç‰‡ + 16pxé—´è· */
    /* ç§»åŠ¨ç«¯ä¹Ÿä½¿ç”¨JavaScriptæ§åˆ¶ */
    transition: transform 0.1s linear;
    /* ç§»åŠ¨ç«¯åˆå§‹ä½ç½®åç§» */
    transform: translateX(calc(-4 * 276px));
  }
  
  .carousel-track .feature-item {
    flex: 0 0 260px; /* ç§»åŠ¨ç«¯ç¨å¾®å‡å°å¡ç‰‡å®½åº¦ */
    margin: 0 8px;
  }
  
  .feature-item {
    padding: 24px 20px;
  }
  
  .feature-icon {
    font-size: 36px;
  }
  
  .feature-item h3 {
    font-size: 18px;
  }
  
  .feature-item p {
    font-size: 14px;
  }
  
  
  
  .steps-flow {
    padding: 10px;
  }
  
  .steps-grid {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .arrow-horizontal {
    transform: rotate(90deg);
    min-width: 40px;
    height: 60px;
  }
  
  .arrow-horizontal .arrow-svg {
    width: 40px;
    height: 60px;
  }
  
  .arrow-vertical {
    transform: rotate(0deg);
    width: 40px;
    height: 60px;
  }
  
  .arrow-vertical .arrow-svg {
    width: 40px;
    height: 60px;
  }
  
  .arrow-back {
    transform: rotate(90deg);
    width: 40px;
    height: 60px;
  }
  
  .arrow-back .arrow-svg {
    width: 40px;
    height: 60px;
  }
  
  
  .intimacy-system {
    padding: 40px 20px;
  }
  
  /* ç§»åŠ¨ç«¯æç¤ºæ¡†é€‚é… */
  .tooltip-content {
    width: 320px;
    left: auto;
    right: 100%;
    margin-left: 0;
    margin-right: 12px;
    padding: 16px;
  }
  
  .tooltip-content::before {
    left: auto;
    right: -6px;
    transform: translateY(-50%) rotate(45deg);
  }
  
  .intimacy-levels {
    flex-direction: column;
    gap: 20px;
  }
  
  .level-item {
    flex-direction: row;
    gap: 12px;
    min-width: auto;
  }
  
  .level-arrow {
    transform: rotate(90deg);
    margin: 8px 0;
  }
}
</style>