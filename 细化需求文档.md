# AI角色扮演聊天网页需求文档

## 一、项目概述

本项目旨在开发一个AI角色扮演聊天网页，用户可以搜索并选择自己感兴趣的角色（如哈利波特、苏格拉底等历史人物或虚构角色），并通过文字或语音与其进行交流。该系统利用七牛云AI大语言模型（x-ai/grok-4-fast）来模拟角色的对话风格和知识背景，提供沉浸式的互动体验。

## 二、项目架构

### 技术栈
- **前端**：Vue 3 + Vite + Vue Router + Axios
- **后端**：Flask + Flask-CORS
- **AI服务**：七牛云AI大模型（x-ai/grok-4-fast）
- **语音处理**：SpeechRecognition（语音识别）

### 项目结构
```
├── backend/              # 后端Flask应用
│   ├── app.py            # Flask主应用入口，定义API路由
│   ├── ai_service.py     # AI服务封装，与七牛云AI API交互
│   ├── voice_service.py  # 语音服务封装，实现语音识别和录音
│   ├── config.py         # 配置文件，包含API密钥等设置
│   ├── requirements.txt  # Python依赖
│   └── .env.example      # 环境变量示例文件
├── frontend/             # 前端Vue应用
│   ├── src/              # 前端源码
│   │   ├── views/        # 页面组件
│   │   │   ├── HomePage.vue        # 首页
│   │   │   ├── ChatPage.vue        # 聊天页面
│   │   │   ├── CharacterList.vue   # 角色列表页
│   │   │   └── SettingsPage.vue    # 设置页面
│   │   ├── components/   # 通用组件
│   │   ├── router/       # 路由配置
│   │   │   └── index.js   # 路由定义
│   │   ├── apiService.js # API服务封装，与后端交互
│   │   ├── main.js       # Vue应用入口
│   │   └── App.vue       # 应用主组件
│   ├── public/           # 静态资源
│   ├── package.json      # NPM配置文件
│   └── vite.config.js    # Vite配置
└── common/               # 公共资源
    └── characters.json   # 角色数据定义
```

## 三、核心功能需求

### 1. 角色管理
- **角色列表展示**：显示所有可选择的角色，包括角色名称、描述、标签和头像
- **角色搜索**：支持通过关键词搜索角色
- **角色详情**：展示角色的详细背景信息
- **预设角色**：系统内置10个精心选择的角色，涵盖历史人物、虚构角色、科学家、艺术家等

### 2. 聊天功能
- **文本聊天**：用户可以通过文本输入与角色进行对话
- **语音聊天**：支持语音输入功能，可通过麦克风录制并识别语音
- **角色扮演**：AI能够模拟选定角色的语言风格、性格特点和知识背景进行对话
- **对话历史**：记录用户与角色的对话历史，支持上下文理解的多轮对话

### 3. AI能力
- **基础对话**：提供通用的聊天能力，回答用户的各种问题
- **角色特定技能**：根据角色的背景和特点，提供专业知识讲解、历史事件还原、创意内容生成等特定技能
- **多模态支持**：预留了图像、音频、视频等多模态输入的能力

## 四、API接口设计

### 1. 获取模型列表
- **URL**: `/api/models`
- **方法**: GET
- **功能**: 获取所有可用的AI模型列表
- **参数**: 无
- **响应**: 
  ```json
  {
    "success": true,
    "models": ["x-ai/grok-4-fast"]
  }
  ```
- **错误处理**: 
  ```json
  {
    "success": false,
    "error": "错误信息"
  }
  ```
  状态码: 500

### 2. 基础聊天接口
- **URL**: `/api/chat`
- **方法**: POST
- **功能**: 提供基础的AI聊天能力
- **参数**: 
  ```json
  {
    "messages": [{"role": "user", "content": "你好"}], // 消息历史
    "model": "x-ai/grok-4-fast", // 可选，AI模型名称
    "stream": false, // 是否流式返回
    "max_tokens": 4096 // 最大生成token数
  }
  ```
- **响应**: 
  ```json
  {
    "success": true,
    "content": "你好！我是AI助手，有什么可以帮助你的吗？"
  }
  ```
- **错误处理**: 
  ```json
  {
    "success": false,
    "error": "messages参数不能为空" // 或其他错误信息
  }
  ```
  状态码: 400（参数错误）或 500（服务器错误）

### 3. 角色扮演聊天接口
- **URL**: `/api/character_chat`
- **方法**: POST
- **功能**: 提供角色扮演聊天能力
- **参数**: 
  ```json
  {
    "character_name": "哈利波特", // 角色名称
    "character_description": "《哈利波特》系列小说的主角...", // 角色描述
    "user_query": "你好，哈利波特！", // 用户提问
    "model": "x-ai/grok-4-fast", // 可选，AI模型名称
    "stream": false, // 是否流式返回
    "skill": "general" // 可选，角色技能类型（general, knowledge, history, creative等）
  }
  ```
- **响应**: 
  ```json
  {
    "success": true,
    "content": "你好！我是哈利波特，很高兴认识你！"
  }
  ```
- **错误处理**: 
  ```json
  {
    "success": false,
    "error": "character_name和user_query参数不能为空" // 或其他错误信息
  }
  ```
  状态码: 400（参数错误）或 500（服务器错误）

## 五、角色数据结构

角色数据存储在`common/characters.json`文件中，每个角色包含以下字段：

```json
{
  "id": "harry-potter",                 // 角色唯一ID
  "name": "哈利波特",                   // 角色名称
  "description": "《哈利波特》系列小说的主角，一个年轻的巫师，勇敢、正义，对抗伏地魔的英雄。", // 角色描述
  "tags": ["虚构", "巫师", "小说角色", "勇敢"],   // 角色标签，用于分类和搜索
  "avatar": "/characters/harry-potter.png" // 角色头像路径
}
```

### 预设角色列表
系统内置了10个精心选择的角色：
1. **哈利波特**（虚构、巫师、小说角色、勇敢）
2. **苏格拉底**（历史人物、哲学家、古希腊、智慧）
3. **阿尔伯特·爱因斯坦**（科学家、物理学家、相对论、天才）
4. **甘地**（政治领袖、和平主义者、印度、独立运动）
5. **玛丽·居里**（科学家、物理学家、化学家、诺贝尔奖）
6. **孔子**（哲学家、教育家、中国古代、儒家）
7. **列奥纳多·达·芬奇**（艺术家、科学家、发明家、文艺复兴）
8. **纳尔逊·曼德拉**（政治领袖、和平主义者、南非、反种族隔离）
9. **威廉·莎士比亚**（文学家、剧作家、诗人、英国）
10. **艾达·洛夫莱斯**（数学家、程序员、女性科学家、计算机先驱）

## 六、用户界面设计

### 1. 首页
- 项目介绍和功能亮点展示
- 快速开始聊天入口
- 热门角色推荐和分类浏览
- 搜索框，方便用户直接查找角色

### 2. 角色列表页
- 角色卡片展示，包含头像、名称、简要描述和标签
- 搜索框，支持关键词搜索
- 标签筛选功能，按角色类型筛选
- 角色详情预览，悬停或点击可查看更多信息
- 分页加载，提高性能

### 3. 聊天页面
- 角色信息展示区，显示当前聊天角色的头像、名称和简介
- 聊天消息列表，按时间顺序显示对话内容
- 消息气泡设计，区分用户和角色消息
- 输入区域，包含文本输入框和语音输入按钮
- 清空对话和切换角色功能
- 响应式设计，适配不同屏幕尺寸

### 4. 设置页面
- 语音设置（识别语言、录音时长等）
- 界面主题选择（亮色/暗色模式）
- 聊天设置（是否保存历史记录等）
- API配置（高级用户可自定义）

## 七、角色技能设计

### 1. 专业知识讲解
- **适用角色**：爱因斯坦、居里夫人、孔子、苏格拉底等科学家和学者
- **功能描述**：深入讲解相关领域的专业知识，提供专业、详细、准确的解释
- **应用场景**：用户学习、知识查询、概念理解
- **提示词设计**：
  ```
  你现在是{character_name}，作为一位{专业领域}的专家，请以你的专业知识来解释以下问题：{user_query}
  请提供详细、准确的专业解释，结合你的研究和理论。
  ```

### 2. 历史事件还原
- **适用角色**：孔子、苏格拉底、甘地、曼德拉等历史人物
- **功能描述**：还原和解释特定的历史事件，提供具体细节和个人感受
- **应用场景**：历史学习、事件研究、背景了解
- **提示词设计**：
  ```
  你现在是{character_name}，请以你亲身经历或所处时代的视角，描述以下历史事件：{user_query}
  请提供具体的细节和你当时的感受，让读者仿佛身临其境。
  ```

### 3. 创意内容生成
- **适用角色**：达芬奇、莎士比亚等艺术家和作家
- **功能描述**：根据用户需求生成诗歌、故事、绘画描述等创意内容
- **应用场景**：创作灵感、内容生成、艺术欣赏
- **提示词设计**：
  ```
  你现在是{character_name}，请发挥你的艺术创造力，创作关于{user_query}的{作品类型}。
  请保持你独特的艺术风格和创作特点。
  ```

### 4. 通用对话能力
- **适用角色**：所有角色
- **功能描述**：进行日常对话，回答一般性问题
- **应用场景**：闲聊、了解角色背景、获取基本信息
- **提示词设计**：基于配置中的CHARACTER_PROMPT_TEMPLATE

## 八、技术实现要点

### 1. 后端实现
- **Flask应用**：使用Flask框架创建RESTful API，处理跨域请求
- **AI服务封装**：在ai_service.py中封装与七牛云AI API的交互逻辑
  - 支持基础聊天和角色扮演聊天
  - 预留多模态输入能力
  - 实现角色特定技能的动态提示词生成
- **语音服务**：在voice_service.py中实现语音识别和录音功能
  - 使用SpeechRecognition库识别语音
  - 支持从麦克风录制音频
- **配置管理**：在config.py中管理API密钥、基础URL、默认模型等配置
  - 支持从环境变量加载敏感信息

### 2. 前端实现
- **Vue 3应用**：使用Vue 3和Vite构建单页应用
- **路由管理**：使用Vue Router实现页面导航
  - 首页：/ 
  - 角色列表页：/characters
  - 聊天页面：/chat/:characterId?
  - 设置页面：/settings
- **API交互**：在apiService.js中封装与后端的HTTP请求
  - 使用Axios库发送请求
  - 实现请求和响应拦截
- **组件化开发**：将页面拆分为可复用的组件
- **响应式设计**：适配不同设备的屏幕尺寸

### 3. AI能力实现
- **模型选择**：使用七牛云x-ai/grok-4-fast模型
- **提示词工程**：设计了角色特定的提示词模板，提高对话质量
- **技能增强**：根据角色类型和用户需求，动态调整提示词，增强特定技能
- **上下文管理**：维护对话历史，支持多轮对话

## 九、配置与部署

### 环境变量配置
项目支持通过.env文件设置环境变量，主要包括：
- QINIU_AI_API_KEY：七牛云AI API密钥
- QINIU_AI_BASE_URL：七牛云AI API基础URL
- FLASK_APP：Flask应用入口文件
- FLASK_ENV：Flask运行环境（development/production）
- FLASK_RUN_PORT：Flask运行端口

### 部署步骤
1. **后端部署**
   - 安装Python依赖：`pip install -r backend/requirements.txt`
   - 设置环境变量或创建.env文件
   - 启动Flask服务器：`python -m flask run`

2. **前端部署**
   - 安装依赖：`npm install`（在frontend目录下）
   - 开发模式：`npm run dev`
   - 构建生产版本：`npm run build`
   - 预览生产版本：`npm run preview`

## 十、未来扩展方向

1. **增加更多角色**：持续丰富角色库，涵盖更多领域和类型的角色
2. **增强语音功能**：优化语音识别和语音合成能力，提供更自然的语音交互
3. **个性化推荐**：根据用户的兴趣和聊天历史，推荐相关角色
4. **对话分享**：支持将有趣的对话内容分享到社交媒体
5. **多语言支持**：扩展支持多种语言的对话能力
6. **角色自定义**：允许用户创建和自定义自己的AI角色
7. **增强多模态能力**：完善图像、音频、视频等多模态输入和处理
8. **社区功能**：添加用户社区，分享聊天经验和创意

## 十一、注意事项

1. **API密钥保护**：确保API密钥等敏感信息存储在环境变量中，不直接硬编码在代码里
2. **用户体验优化**：确保聊天响应速度快，界面操作流畅
3. **内容安全**：实现内容过滤机制，确保生成内容符合规范
4. **错误处理**：完善异常处理机制，提供友好的错误提示
5. **性能优化**：优化API调用和前端渲染性能，确保系统稳定运行
6. **隐私保护**：妥善处理用户数据，保护用户隐私
7. **兼容性**：确保在不同浏览器和设备上的兼容性
8. **可扩展性**：设计灵活的架构，方便未来功能扩展